# Name: wercker.yml
# Purpose: Build and deploy steps for Coder application.

box: debian
build:
  steps:
    - arjen/hugo-build@1.25.2:
        version: "0.32.3"
    - script:
        name: copy output directory
        code: |
             cp * -R $WERCKER_OUTPUT_DIR

deploy:
  steps:
     - install-packages:
         packages: openssh-client openssh-server rsync

     - add-to-known_hosts:
         hostname: $HOSTNAME

     - add-ssh-key:
         keyname: linode_ssh

    - mktemp:
         envvar: PRIVATEKEY_FILE
         
    - create-file:
         name: write key
         filename: $PRIVATEKEY_FILE
         content: $linode_ssh_PRIVATE
         overwrite: true

    - lrh-it-solutions/rsync-deploy@0.4.6:
         host: $HOSTNAME
         user: $USER
         directory: $DEPLOY_PATH
         sshkey: $PRIVATEKEY_FILE
